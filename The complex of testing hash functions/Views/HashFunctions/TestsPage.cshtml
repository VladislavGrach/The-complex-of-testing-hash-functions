@{
    ViewData["Title"] = "Тестирование хеш-функции";
}

<h1 class="mb-4">Тестирование хеш-функции по NIST</h1>

<!-- Форма ввода -->
<form method="post" action="/HashFunctions/TestRandomness">
    <label>Выберите хеш-функцию:</label>
    <select name="hashFunctionId" class="form-control w-50" required>
        @if (ViewBag.HashFunctions != null && ViewBag.HashFunctions.Count > 0)
        {
            @foreach (var function in ViewBag.HashFunctions)
            {
                <option value="@function.Id">@function.Name</option>
            }
        }
        else
        {
            <option disabled>Нет доступных хеш-функций</option>
        }
    </select>
    <label>Введите хеш:</label>
    <input type="text" name="hash" class="form-control w-50" required />

    <div class="mt-3">
        <label>Выберите тесты:</label>
        <div>
            <input type="checkbox" name="tests" value="Monobit" checked /> Монобит-тест
        </div>
        <div>
            <input type="checkbox" name="tests" value="BlockFrequency" checked /> Тест на частоту в блоках
        </div>
        <div>
            <input type="checkbox" name="tests" value="Poker" checked /> Покер-тест
        </div>
        <div>
            <input type="checkbox" name="tests" value="Runs" checked /> Тест на серийность
        </div>
        <div>
            <input type="checkbox" name="tests" value="LongestRunOfOnes" checked /> Тест на самую длинную последовательность единиц
        </div>
        <div>
            <input type="checkbox" name="tests" value="Permutations" checked /> Тест на перестановки и преобразования
        </div>
        <div>
            <input type="checkbox" name="tests" value="BirthdaySpacings" checked /> Тест дней рождения
        </div>
        <div>
            <input type="checkbox" name="tests" value="OverlappingSums" checked /> Тест равномерности распределения битов
        </div>
        <div>
            <input type="checkbox" name="tests" value="OverlappingTemplateMatching" checked /> Тест совпадения шаблонов
        </div>
    </div>

    <button type="submit" class="btn btn-success mt-2">Запустить тесты</button>
</form>

<hr />

<!-- Результаты тестирования -->
@if (ViewBag.Results != null)
{
    <h2>Результаты тестирования</h2>
    <p><strong>Исходный хеш:</strong> @ViewBag.Hash</p>
    <p><strong>Бинарное представление:</strong> @ViewBag.BinaryHash</p>
    <p><strong>Хеш-функция:</strong> @ViewBag.HashFunctionName</p>
    <table class="table">
        <thead>
            <tr>
                <th>Название теста</th>
                <th>Результат (Score)</th>
                <th>Пройден?</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var result in ViewBag.Results)
            {
                <tr>
                    <td>@result.TestType</td>
                    <td>@result.Score</td>
                    <td>
                        @if (result.Score < 1.96)
                        {
                            <span style="color: green;">✅</span>
                        }
                        else
                        {
                            <span style="color: red;">❌</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
